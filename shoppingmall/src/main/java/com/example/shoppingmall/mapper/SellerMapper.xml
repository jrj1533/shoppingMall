<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.shoppingmall.mapper.SellerMapper">
	<!-- 주문리스트 -->
	<select id="selectOrderList" resultType="map">
		SELECT
		    i.item_no AS itemNo,
		    i.username AS seller,
		    i.option_no AS optionNo,
		    i.item_title AS itemTitle,
		    i.item_amount AS itemAmount,
		    u2.name AS buyerName, 
		    o.total_price AS totalPrice,
		    o.status AS ordersStatus,
		    o.order_date AS orderDate,
		    d.status AS deliveryStatus,
		    a.address AS address,
		    a.address2 AS address2,
		    a.post_code AS postCode
		FROM order_cart oc
		INNER JOIN item i ON oc.item_no = i.item_no
		INNER JOIN user u ON i.username = u.username 
		INNER JOIN orders o ON oc.order_no = o.order_no
		INNER JOIN user u2 ON o.username = u2.username
		INNER JOIN delivery d ON o.order_no = d.deliver_no
		INNER JOIN user_address ua ON o.username = ua.username
		INNER JOIN address a ON ua.address_no = a.address_no
	<where>
		i.username = #{username}
		<if test="buyer != null and buyer != ''">
			AND u2.name LIKE CONCAT('%', #{buyer}, '%')
		</if>
		
		<if test="deliveryStatus != null and deliveryStatus != ''">
			AND d.status = #{deliveryStatus}
		</if>
		
		<if test="ordersStatus != null and ordersStatus != ''">
			AND o.status = #{ordersStatus}
		</if>
	</where>
	LIMIT #{beginRow}, #{size}
	</select>
	
	<!-- 주문리스트 페이징 -->
	<select id="totalCount" resultType="int" parameterType="com.example.shoppingmall.dto.Page">
		SELECT COUNT(*)
		FROM orders o
		inner join delivery d
		<where>
			<if test="buyer != null and buyer != ''">
				AND o.username LIKE CONCAT('%', #{buyer}, '%')
			</if>
			
			<if test="deliveryStatus != null and deliveryStatus != ''">
				AND d.status = #{deliveryStatus}
			</if>
			
			<if test="ordersStatus != null and ordersStatus != ''">
				AND o.status = #{ordersStatus}
			</if>
		</where>
	</select>
	
</mapper>